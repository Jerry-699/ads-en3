<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lifeinvader Ads — EN-03 (Auto-Detect + Manual Fix)</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0e1320; --card:#11182a; --muted:#99a3b3; --fg:#e8eefc; --brand:#6aa5ff; --ok:#1dd1a1; --warn:#ffb020; --bad:#ff6b6b; --line:#1f2940;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
  h1{font-size:22px;margin:0 0 14px}
  .hint{color:var(--muted);font-size:13px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);margin:18px 0}
  textarea, input, select{width:100%;background:#0c1120;border:1px solid var(--line);color:var(--fg);padding:12px 12px;border-radius:10px;outline:none}
  textarea{min-height:140px;resize:vertical}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .row-3{display:grid;grid-template-columns:1.1fr .7fr .6fr;gap:14px}
  .btn{display:inline-flex;align-items:center;gap:8px;border:none;background:var(--brand);color:#081022;font-weight:700;padding:10px 14px;border-radius:10px;cursor:pointer}
  .btn.secondary{background:#1b253d;color:var(--fg)}
  .btn.ghost{background:transparent;border:1px solid var(--line);color:var(--fg)}
  .btn.ok{background:var(--ok);color:#04180f}
  .bad{color:var(--bad);font-weight:600}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border:1px solid var(--line);border-radius:999px;margin:6px 6px 0 0;font-size:12px;color:var(--muted)}
  .output{font-weight:600}
  .mini{font-size:12px;color:var(--muted)}
  .stack{display:flex;gap:10px;flex-wrap:wrap}
  .hidden{display:none}
  .group{display:grid;gap:8px}
</style>
</head>
<body>
<div class="wrap">
  <h1>⚡ Auto-Detect (Raw Ad) + Manual Fix</h1>
  <p class="hint">Paste any raw ad. The parser auto-detects category, opener, subject, level quality, and money label/amount. Blacklist is enforced. k/m money fixed. Million spelled correctly.</p>

  <div class="card">
    <div class="group">
      <label class="mini">Raw ad text</label>
      <textarea id="raw" placeholder='e.g., "selling level 3 pickaxe price 20k"'></textarea>
      <div class="stack">
        <button id="gen" class="btn">Generate</button>
        <button id="clear" class="btn secondary">Clear</button>
      </div>
    </div>

    <div class="group" style="margin-top:14px">
      <label class="mini">Formatted Output</label>
      <input id="out" class="output" readonly placeholder="Your formatted ad will appear here…" />
      <div class="stack">
        <button id="copy" class="btn ghost">Copy</button>
        <span id="flags" class="stack"></span>
      </div>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 6px">Manual Fix (optional)</h3>
    <p class="hint">These fields are auto-filled from your raw ad. Tweak them and press <b>Apply</b> or <b>Apply & Save</b> (saves a local rule that auto-applies next time).</p>

    <div class="row-3">
      <div class="group">
        <label class="mini">Opener</label>
        <select id="mfOpener">
          <option>Auto (detected)</option>
          <option>Selling</option>
          <option>Buying</option>
          <option>Trading</option>
          <option>Selling or trading</option>
          <option>Renting out</option>
          <option>Renting</option>
        </select>
      </div>

      <div class="group">
        <label class="mini">Money label</label>
        <select id="mfLabel">
          <option>Auto (detected)</option>
          <option>Price</option>
          <option>Budget</option>
          <option>Rent</option>
        </select>
      </div>

      <div class="group">
        <label class="mini">Amount</label>
        <input id="mfAmount" placeholder="e.g., 20k, 1.7k each, 1.5m, Negotiable" />
        <div class="mini">k/m shorthands supported: 20k → $20.000, 1.5k → $1.500, 50m → $50 Million.</div>
      </div>
    </div>

    <div class="group" style="margin-top:12px">
      <label class="mini">Subject (edit main sentence)</label>
      <input id="mfSubject" placeholder='e.g., high quality pickaxe; "Obey R8" with full configuration, visual upgrades and insurance; house №85 with 5 g.s. and 3 w.h.; etc.' />
    </div>

    <div class="stack" style="margin-top:14px">
      <button id="apply" class="btn">Apply</button>
      <button id="applySave" class="btn ok">Apply &amp; Save</button>
      <label class="mini" style="margin-left:6px">
        <input type="checkbox" id="autoRules" checked /> Auto-apply rules
      </label>
    </div>

    <div id="rulesBox" class="mini" style="margin-top:8px;color:var(--muted)"></div>
  </div>

  <p class="hint">Built for EN-03 policy accuracy — opener words, Price/Budget/Rent, dot-thousands, “№” for numbers, feature order, blacklist, level→quality, conversion of “k/m”, and category detection (Real Estate / Auto / Business / Dating / Work / Discounts / Services / Other).</p>
</div>

<script>
/* ----------------------- helpers ----------------------- */
const $ = s=>document.querySelector(s);
const cap = s => s ? s.charAt(0).toUpperCase()+s.slice(1) : s;
const trimMulti = s => s.replace(/\s+/g,' ').trim();
const copy = (el)=>{el.select();document.execCommand('copy');};

/* ------------------- hard rules / maps ------------------- */
// blacklist (reject if hits)
const BLACKLIST = [
  'firearm','gun','pistol','rifle','ammo','ammunition','bulletproof','armor plate','weed','cannabis','cocaine',
  'surgical mask','medical mask','covid mask','balaclava','radar','scanner','rope','head bag','usb with virus',
  'lock pick','lockpick','crowbar','bandit mask','animal skin','anti-radar','engine block','air horn',
  'grand coin','battlepass','nationality','sexual','stripper'
];

// quality levels
const LEVEL_TO_QUALITY = {
  '1':'low quality','lvl1':'low quality','level1':'low quality',
  '2':'medium quality','lvl2':'medium quality','level2':'medium quality',
  '3':'high quality','lvl3':'high quality','level3':'high quality',
  '4':'max quality','lvl4':'max quality','level4':'max quality'
};

// category lexicons (shortened but covers all critical terms inc. pickaxe)
const LEX = {
  realestate: ['house','apartment','penthouse','mansion','casino apartment','casino penthouse'],
  auto: ['car','truck','motorcycle','bike','atv','boat','helicopter','plane','monowheel','license plate'],
  business: [
    'ammunition store','bar','car wash','chip tuning','clothing shop','cowshed','electric station','farm','flower shop',
    'freight train','gas station','hair salon','jewelry store','oil well','parking','plantation','car sharing','state object',
    'service station','24/7 store','tattoo studio','taxi company','atm','juice shop','burger shop','fight club','warehouse'
  ],
  work:['hiring','looking for work','job','construction site','driver','lawyer','dj','photographer','bodyguard','assistant','trucker','professional dancer','professional singer'],
  dating:['looking for','boyfriend','girlfriend','family','valentine','friends','casino poker players'],
  discounts:['discount %','% discount','% off'],
  services:['happy hour','template','join','offering','service'],
  other: [
    // items (ensure pickaxe present)
    'pickaxe','fishing rod','inventory','battery','charger','fuel canister','premium fuel canister','repair kit',
    'grand ticket','rare lottery ticket','regular lottery ticket','flame and water lottery ticket','cayo perico ticket','car ticket',
    'secret ticket','secret ticket fragment','luminous wheels','mask','paint can','pearl','pet food',
    'video card','wires','timber','thread','snow','token','tonic treat','elixir for a pet','leash',
    'resource barrel','solar barrel','gasoline barrel','kerosene barrel',
    // containers (key terms)
    'container','containers','valuable container','racer container','wheels 1 container','wheels 2 container','wheels 3 container',
    'ingrand container','progen container','benefactor container','organization container','valentine 2025 container',
    // pets
    'cage with a','on shoulder pet',
    // fruits & veg
    'pineapple','mandarin','strawberry','cabbage','mushroom','milk','fish','perch','carp','salmon','trout'
  ]
};

// opener synonyms → canonical
const OPENER_MAP = [
  [/^(?:looking\s*to\s*buy|looking\s*to\s*purchase|ltb)\b/i,'Buying'],
  [/^(?:selling\s*or\s*trading|s\/t)\b/i,'Selling or trading'],
  [/\bbuying\b/i,'Buying'],
  [/\bselling\b/i,'Selling'],
  [/\btrading\b/i,'Trading'],
  [/\brenting out\b/i,'Renting out'],
  [/\brenting\b/i,'Renting'],
];

// money label by opener
const MONEY_BY_OPENER = {
  'Buying':'Budget',
  'Selling':'Price',
  'Trading':'Price',
  'Selling or trading':'Price',
  'Renting out':'Rent',
  'Renting':'Budget'
};

// feature phrases (auto & real estate)
const AUTO_FEATURES_ORDER = ['with full configuration','with partial configuration','visual upgrades','luminous wheels','insurance','turbo kit','drift kit'];
const RE_FEATURES_ORDER = ['a garden','2 g.s.','5 g.s.','9 g.s.','25 g.s.','3 w.h.','4 w.h.','5 w.h.','custom interior','insurance','helipad','swimming pool','tennis court','long driveway','spacious backyard','nice views','beautiful views','great views'];

/* -------------------- money parsing -------------------- */
function parseMoney(raw){
  if(!raw) return null;
  let s = raw.toLowerCase();

  // look for number-like chunks
  // support: 20k, 1.7k, 50m, $500, 500.000, 1.7m each
  let m = s.match(/(\$?\s*\d+(?:[\.,]\d+)?\s*(?:k|m)?)(?:\s*each)?/i);
  if(!m) return null;
  let token = m[1].replace(/\s+/g,''); // "$20k" / "1.5m" / "1500"

  // normalize
  let isMillion=false;
  if(/m$/i.test(token)){ isMillion=true; token = token.replace(/m$/i,''); }
  let isK=false;
  if(/k$/i.test(token)){ isK=true; token = token.replace(/k$/i,''); }
  token = token.replace(/\$/g,'').replace(/,/g,'.');

  let num = parseFloat(token || '0');
  if(isNaN(num)) return null;

  if(isMillion){
    // keep “$x Million”
    return {text:`$${num} Million`, each:/each/i.test(raw)};
  }
  // thousands with dots
  if(isK){ num = num*1000; }
  // format with dot thousands
  let formatted = formatDotThousands(Math.round(num));
  return {text:`$${formatted}`, each:/each/i.test(raw)};
}

function formatDotThousands(n){
  // 20000 -> 20.000 ; 1500000 -> 1.500.000
  let s = String(n);
  return s.replace(/\B(?=(\d{3})+(?!\d))/g,'.');
}

/* -------------------- quality mapping -------------------- */
function mapLevelsToQuality(text){
  // level / lvl [1-4] → low/medium/high/max quality [thing]
  return text.replace(/\b(lvl|level)\s*(1|2|3|4)\b/gi,(_, __, d)=>{
    const q = LEVEL_TO_QUALITY[d] || _;
    return q;
  });
}

/* -------------------- opener detect -------------------- */
function detectOpener(text){
  for(const [re,lab] of OPENER_MAP){
    if(re.test(text)) return lab;
  }
  // default if nothing matched
  if(/\bbudget\b/i.test(text)) return 'Buying';
  if(/\bprice|for sale|sell\b/i.test(text)) return 'Selling';
  return 'Selling';
}

/* -------------------- category detect -------------------- */
function hasAny(text, list){ return list.some(w=>new RegExp(`\\b${escapeRe(w)}\\b`,'i').test(text)); }
function escapeRe(s){ return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }

function detectCategory(text){
  const t = text.toLowerCase();
  if(hasAny(t,LEX.realestate)) return 'Real Estate';
  if(hasAny(t,LEX.auto)) return 'Auto';
  if(hasAny(t,LEX.business)) return 'Business';
  if(hasAny(t,LEX.discounts) || /\b\d{1,3}%\b/.test(t)) return 'Discounts';
  if(hasAny(t,LEX.services)) return 'Services';
  if(hasAny(t,LEX.work)) return 'Work';
  if(hasAny(t,LEX.dating) || /^looking\s+for\b/i.test(t)) return 'Dating';
  return 'Other';
}

/* ------------------ subject extraction ------------------ */
function extractSubject(text, category){
  let t = 'item';
  const low = text.toLowerCase();

  // real estate
  if(category==='Real Estate'){
    if(/casino\s+apartment/i.test(text)) return 'Casino penthouse';
    if(/house\s*№?\s*(\d+)/i.test(text)) return `house №${RegExp.$1}`;
    if(/apartment\s*№?\s*(\d+)/i.test(text)) return `apartment №${RegExp.$1}`;
    if(/penthouse\s*№?\s*(\d+)/i.test(text)) return `penthouse №${RegExp.$1}`;
    if(/mansion\s*№?\s*(\d+)/i.test(text)) return `mansion №${RegExp.$1}`;
    if(/\bhouse\b/i.test(text)) return 'a house';
    if(/\bapartment\b/i.test(text)) return 'an apartment';
    if(/\bpenthouse\b/i.test(text)) return 'Casino penthouse';
    if(/\bmansion\b/i.test(text)) return 'a mansion';
  }

  // auto (try quoted first)
  let qm = text.match(/"([^"]+)"/);
  if(category==='Auto' && qm){
    t = `"${qm[1]}"`;
  } else if(category==='Auto'){
    // plain generic
    if(/\bmonowheel\b/i.test(text)){
      let typ = text.match(/\btype\s*(\d+)\b/i);
      t = typ ? `"Monowheel" of type ${typ[1]}` : `"Monowheel"`;
    } else if(/\b(helicopter|plane|boat)\b/i.test(text)){
      t = `a ${RegExp.$1}`;
    } else {
      t = 'a car';
    }
  }

  // business
  if(category==='Business'){
    // normalize “personal business” → “private business”
    if(/\bpersonal business\b/i.test(text)) return 'private business';
    // business name detection
    for(const b of LEX.business){
      if(new RegExp(`\\b${escapeRe(b)}\\b`,'i').test(text)){
        // number?
        let n = text.match(/№\s*([0-9\-]+)/i) || text.match(/\bno\.?\s*([0-9\-]+)/i);
        return n ? `${b} №${n[1]}` : `${b} business`;
      }
    }
    return 'private business';
  }

  // dating
  if(category==='Dating'){
    // person or generic
    let nm = text.match(/\b([A-Z][a-z]+)\s+([A-Z][a-z]+)\b/);
    if(nm) return `Looking for ${nm[1]} ${nm[2]}`;
    if(/\bfamily members?\b/i.test(text)) return 'Looking for family members';
    if(/\bfamily\b/i.test(text)) return 'Looking for a family';
    if(/\bboyfriend(s)?\b/i.test(text)) return 'Looking for a boyfriend';
    if(/\bgirlfriend(s)?\b/i.test(text)) return 'Looking for a girlfriend';
    return 'Looking for a person';
  }

  // work/services/discounts: leave for templates
  if(category==='Work' || category==='Services' || category==='Discounts'){
    return trimMulti(text);
  }

  // OTHER (huge basket). Catch “level/lvl N <thing>”
  const mapped = mapLevelsToQuality(text);
  if(/(low|medium|high|max) quality\s+(pickaxe|fishing\s*rod|inventory|engine|transmission|suspension|brakes|tires)/i.test(mapped)){
    return `${RegExp.$1} ${RegExp.$2}`.replace(/\s+/g,' ').trim();
  }
  // explicit items we care about (ensure “pickaxe”)
  const ITEM_WORDS = [
    'pickaxe','fishing rod','inventory','battery','charger','repair kit','video card','wires','timber','thread','snow','token','tonic treat',
    'elixir for a pet','leash','license plate','luminous wheels','paint can','pearl','pet food',
    'container','containers','racer container','wheels 1 container','wheels 2 container','wheels 3 container',
    'grand ticket','rare lottery ticket','regular lottery ticket','flame and water lottery ticket','cayo perico ticket','car ticket','secret ticket','secret ticket fragment',
    'pineapple','mandarin','strawberry','cabbage','mushroom','milk','salmon','perch','carp','trout',
    'cage with a','on shoulder pet'
  ];
  for(const w of ITEM_WORDS){
    if(new RegExp(`\\b${escapeRe(w)}\\b`,'i').test(mapped)){
      // singularize some
      if(/cage with a/i.test(w)) return 'cage with a pet';
      return w;
    }
  }

  // quoted fallback if provided
  if(qm) return `"${qm[1]}"`;
  // last resort: words after the opener
  let open = detectOpener(text);
  let after = text.replace(new RegExp(`^\\s*${open}\\b\\s*`,`i`),'');
  after = after.replace(/\b(price|budget|rent).*/i,'').trim();
  if(after) return after;
  return 'item';
}

/* ------------------ feature normalizers ------------------ */
function normalizePhrases(text){
  let t = ' ' + text + ' ';
  // config/upgrades (auto)
  t = t.replace(/\b(max config|max tuning|fully upgraded)\b/gi,' with full configuration ');
  t = t.replace(/\b(nearly max|part\s*l?v?l?3?|lvl3?)\b/gi,' with partial configuration ');
  t = t.replace(/\b(body upgrades|body kit)\b/gi,' visual upgrades ');
  t = t.replace(/\bturbo\b/gi,' turbo kit ');
  t = t.replace(/\bdrift (tuning|assistance)?\b/gi,' drift kit ');
  t = t.replace(/\b(luminous (rims|unique wheels?)|unique wheels)\b/gi,' luminous wheels ');

  // extras → of type
  t = t.replace(/\bextras?\b/gi,' of type ');
  // scarf → mask combo already allowed by using “mask” everywhere

  // level→quality (inventory and parts)
  t = mapLevelsToQuality(t);

  // casino apartment
  t = t.replace(/\bcasino apartment\b/gi,' Casino penthouse ');

  // personal business → private business
  t = t.replace(/\bpersonal business\b/gi,' private business ');

  return trimMulti(t);
}

/* -------------------- rule savings -------------------- */
const RULES_KEY='li_en3_rules';
function loadRules(){ try{return JSON.parse(localStorage.getItem(RULES_KEY)||'[]')}catch{ return []} }
function saveRules(r){ localStorage.setItem(RULES_KEY, JSON.stringify(r)); }
function showRules(){ const r=loadRules(); $('#rulesBox').textContent = r.length ? `${r.length} rule(s) saved.` : 'No rules saved yet.'; }

/* ------------- main compose (one sentence) ------------- */
function compose(opener, subject, category, moneyLabel, amountObj){
  // subject fixes
  let subj = subject;

  // level→quality already mapped; capitalize special cases
  subj = subj.replace(/\b(low|medium|high|max) quality\b/g,(m)=>m.charAt(0).toUpperCase()+m.slice(1));

  // feature order (auto/real estate)
  if(category==='Auto'){
    // ensure “with …” first then extras
    // (already normalized; this keeps order)
    let buf=subj;
    const picked=[];
    for(const f of AUTO_FEATURES_ORDER){
      const r=new RegExp(`\\b${escapeRe(f)}\\b`,'i');
      if(r.test(buf)){ picked.push(f); buf=buf.replace(r,''); }
    }
    subj = trimMulti(buf);
    if(picked.length) subj = `${subj}, ${picked.join(', ').replace(', drift kit',' and drift kit')}`;
  }
  if(category==='Real Estate'){
    let buf=subj;
    const picked=[];
    for(const f of RE_FEATURES_ORDER){
      const r=new RegExp(`\\b${escapeRe(f)}\\b`,'i');
      if(r.test(buf)){ picked.push(f); buf=buf.replace(r,''); }
    }
    subj = trimMulti(buf);
    if(picked.length){
      const last = picked.pop();
      subj = `${subj} with ${picked.join(', ')}${picked.length?', ':''}${picked.length?'and ':''}${last}`.replace('with  ,','with ');
      subj = subj.replace(/\s+,/g,',');
    }
  }

  // Money label & amount
  const label = moneyLabel || MONEY_BY_OPENER[opener] || 'Price';
  let money = 'Negotiable';
  if(amountObj && amountObj.text) money = amountObj.text + (amountObj.each?' each':'');
  const suffix = /\d$/.test(money) ? '' : '.';

  // Sentence
  let sent = `${opener} ${cap(subj)}. ${label}: ${money}${suffix}`;
  // If ends with number, no period
  if(/\d$/.test(sent)) sent = sent.replace(/\.\s*$/,'');
  // Capitalize start
  sent = cap(sent);
  // Fix double spaces
  return trimMulti(sent);
}

/* --------------------- main handler --------------------- */
function generateFromRaw(){
  const raw = trimMulti($('#raw').value || '');
  $('#flags').innerHTML='';
  $('#out').value='';
  if(!raw){ return; }

  // live rule auto-apply
  if($('#autoRules').checked){
    const rules = loadRules();
    for(const r of rules){
      if(new RegExp(r.when,'i').test(raw)){
        $('#raw').value = raw.replace(new RegExp(r.find,'ig'), r.replace);
      }
    }
  }

  // blacklist
  const low = raw.toLowerCase();
  for(const b of BLACKLIST){
    if(low.includes(b)){
      $('#out').value = `Rejected: contains blacklisted content (“${b}”).`;
      badge('Rejected', 'bad');
      return;
    }
  }

  // normalize phrases first (maps levels, configs, etc.)
  const normalized = normalizePhrases(raw);

  // opener
  const opener = detectOpener(normalized);

  // category
  const category = detectCategory(normalized);

  // subject
  const subject = extractSubject(normalized, category);

  // money label derived from opener; amount
  const amountMatch = normalized.match(/\b(?:price|budget|rent)\s*[:\-]?\s*([^\s][^\n\r]*)/i);
  let moneyObj = parseMoney(amountMatch ? amountMatch[1] : normalized); // fallback scans whole text
  const label = MONEY_BY_OPENER[opener];

  // populate manual fix
  $('#mfOpener').value = opener;
  $('#mfLabel').value = label ? label : 'Auto (detected)';
  $('#mfAmount').value = moneyObj ? (moneyObj.text.replace('$','').replace(' Million','m')) : 'Negotiable';
  $('#mfSubject').value = subject;

  // compose
  const sentence = compose(opener, subject, category, label, moneyObj);
  $('#out').value = sentence;

  // badges
  badge(`Detected: ${category}`);
  badge(`Action: ${opener}`);
  badge(`Money: ${label}`);
  if(moneyObj) badge('k/m fixed ✓');
  if(/million\./i.test(sentence)) badge('Million spelling ✓');
}

function badge(text, cls){
  const span = document.createElement('span');
  span.className = 'pill' + (cls?' '+cls:'');
  span.textContent = text;
  $('#flags').appendChild(span);
}

/* ------------------- manual apply/save ------------------- */
function applyManual(saveRule=false){
  const opener = $('#mfOpener').value.includes('Auto') ? detectOpener($('#raw').value) : $('#mfOpener').value;
  let label = $('#mfLabel').value.includes('Auto') ? MONEY_BY_OPENER[opener] : $('#mfLabel').value;

  // amount parse: allow plain “Negotiable”
  let amt = $('#mfAmount').value.trim();
  let moneyObj = null;
  if(/negotiable/i.test(amt) || !amt){ moneyObj = null; }
  else{
    // allow input like 20k / 1.5m / $500 / 50000
    moneyObj = parseMoney(amt);
    if(!moneyObj){ // try raw digits
      const n = parseFloat(amt.replace(/[^\d.]/g,'')||'');
      if(!isNaN(n)){ moneyObj = {text:`$${formatDotThousands(Math.round(n))}`}; }
    }
  }

  const subject = $('#mfSubject').value.trim() || extractSubject($('#raw').value, detectCategory($('#raw').value));
  const cat = detectCategory($('#raw').value);

  const sentence = compose(opener, subject, cat, label, moneyObj);
  $('#out').value = sentence;

  if(saveRule){
    // save simple regex rule that fixes subject/money for similar raw lines
    const rules = loadRules();
    rules.push({
      when: '\\b'+escapeRe(subject.split(' ')[0])+'\\b',
      find: '(level\\s*[1-4]|lvl\\s*[1-4])',
      replace: subject
    });
    saveRules(rules);
    showRules();
  }
}

/* ------------------------ wiring ------------------------ */
$('#gen').addEventListener('click', generateFromRaw);
$('#clear').addEventListener('click', ()=>{ $('#raw').value=''; $('#out').value=''; $('#flags').innerHTML=''; });
$('#copy').addEventListener('click', ()=>copy($('#out')));
$('#apply').addEventListener('click', ()=>applyManual(false));
$('#applySave').addEventListener('click', ()=>applyManual(true));
showRules();

/* -------------------- starters (demo) -------------------- */
// prefill for quick test
$('#raw').value = 'selling level 3 pickaxe price 20k';
</script>
</body>
</html>
