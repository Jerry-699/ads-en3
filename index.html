<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Lifeinvader Ads ‚Äî EN-03 (Auto Detect)</title>

  <!-- Bootstrap 5 CSS (reliable CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">

  <!-- Google Material Icons (optional, page still looks fine without) -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"/>

  <style>
    :root{ --ok:#10b981; --warn:#d97706; --bad:#e11d48; }
    body{ background:#f3f5f9; }
    .header {
      min-height: 28vh;
      background: url('https://images.unsplash.com/photo-1496307042754-b4aa456c4a2d?q=80&w=1600&auto=format&fit=crop') center/cover no-repeat;
      position: relative;
    }
    .header::after{
      content:""; position:absolute; inset:0; background:linear-gradient(135deg,#5b7cfa88,#111827aa);
    }
    .header .container{ position:relative; z-index:2; }
    .app-card{
      margin-top:-80px; background:#fff; border-radius:1rem; box-shadow:0 20px 40px rgba(2,6,23,.12);
    }
    .chip{display:inline-block;padding:.25rem .55rem;border-radius:999px;background:#eef2ff;margin:.125rem;font-size:.8rem}
    .chip.ok{background:rgba(16,185,129,.12);color:var(--ok)}
    .chip.warn{background:rgba(217,119,6,.12);color:var(--warn)}
    .chip.bad{background:rgba(225,29,72,.12);color:var(--bad)}
    .note{color:#6b7280;font-size:.92rem}
    .error-box{border-left:4px solid var(--bad); background:rgba(225,29,72,.08); padding:.5rem .75rem; border-radius:.5rem}
    .policy-box{border-left:4px solid #3b82f6; background:#eff6ff; padding:.6rem .8rem; border-radius:.5rem}
    .icon{font-family:'Material Icons Round'; font-size:1.2rem; vertical-align:-.2rem; margin-right:.25rem}
    /* Dark/Light toggle */
    .theme-toggle{ position:fixed; right:16px; bottom:16px; z-index:999; }
    @media (prefers-color-scheme: dark){
      body{ background:#0b1220; color:#e5e7eb; }
      .app-card{ background:#0f172a; }
      .form-control, .form-select{ background:#111827; color:#e5e7eb; border-color:#253057; }
      .form-control::placeholder{ color:#9aa4b2; }
      .policy-box{ background:rgba(59,130,246,.12); }
      .error-box{ background:rgba(225,29,72,.12); }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <section class="header d-flex align-items-center text-center text-white">
    <div class="container py-5">
      <h1 class="fw-bold">Lifeinvader Ads ‚Äî EN-03</h1>
      <p class="lead mb-0">Policy-accurate ad builder with <b>Auto-Detect</b></p>
    </div>
  </section>

  <!-- Card -->
  <div class="container">
    <div class="app-card p-4 p-md-5">
      <div class="policy-box mb-3 small">
        Paste <b>any raw ad</b>. It auto-detects <b>category</b>, <b>action</b>, and <b>money label</b>; fixes money formats;
        applies Real Estate / Auto / Business / Dating / Work rules; blocks blacklisted content; and outputs a
        <b>policy-perfect</b> ad (‚Ññ, feature order, upgrades order, etc.).
      </div>

      <!-- Auto-Detect -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white">
          <h5 class="mb-0"><span class="icon">bolt</span>Auto-Detect (Raw Ad)</h5>
        </div>
        <div class="card-body">
          <label for="rawInput" class="form-label">Raw ad text</label>
          <textarea id="rawInput" class="form-control" rows="4"
            placeholder='e.g., selling house no 85 with garden. price negotiable OR "looking to buy ruby price negotiable" OR selling Ubermacht M5 (E34) full config + insurance 8m'></textarea>
          <div class="note mt-2">
            Examples it fixes: <b>selling house no 85</b> ‚Üí <i>Selling house ‚Ññ85. Price: Negotiable.</i> ‚Ä¢
            <b>buyyingng a Ruby. Price: Negotiable.</b> ‚Üí <i>Buying a ruby. Budget: Negotiable.</i> ‚Ä¢
            <b>looking to purchase car</b> ‚Üí <i>Buying a car. Budget: Negotiable.</i>
          </div>
          <div class="d-flex gap-2 mt-3">
            <button class="btn btn-primary" onclick="generateFromRaw()">Generate</button>
            <button class="btn btn-outline-secondary" onclick="clearRaw()">Clear</button>
          </div>
        </div>
      </div>

      <!-- Output -->
      <h6 class="fw-semibold">Formatted Output</h6>
      <div class="input-group mb-1">
        <input id="finalOutput" class="form-control" readonly placeholder="Your formatted ad will appear here‚Ä¶">
        <button class="btn btn-success" onclick="copyText()">Copy</button>
      </div>
      <div id="chips" class="mb-2"></div>
      <div id="checks" class="mb-2"></div>
      <div id="errors" class="mb-2"></div>

      <hr class="my-4">
      <div class="small text-muted">
        Designed to match EN-03 rules: opener words, Price/Budget/Rent, dot-thousands, ‚Ññ for numbers, Real Estate feature order,
        apartments not insured, vehicles quoted with upgrade order (configuration ‚Üí visual upgrades ‚Üí luminous wheels ‚Üí insurance ‚Üí turbo kit ‚Üí drift kit),
        Beach Market rule (no ‚ÄúNegotiable‚Äù line), license plate length 3‚Äì7, blacklist, etc.
      </div>
    </div>
  </div>

  <!-- Theme toggle (system default; users can flip) -->
  <div class="theme-toggle">
    <button id="themeBtn" class="btn btn-dark rounded-pill px-3 py-2">üåô / ‚òÄÔ∏è</button>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>

  <script>
    // ===== Tiny theme toggle (adds/removes a 'light' class) =====
    const themeBtn = document.getElementById('themeBtn');
    themeBtn.addEventListener('click', () => {
      document.documentElement.toggleAttribute('data-theme-light');
      document.body.classList.toggle('bg-white');
    });

    // ===== Helpers & constants (same logic as before, trimmed for brevity but policy-accurate) =====
    const $ = id => document.getElementById(id);
    const lc = s => (s||'').toLowerCase();
    const tcFirst = s => s ? s[0].toUpperCase() + s.slice(1) : s;

    const OFFICIAL_PLACES = ['Vinewood Hills','Rockford Hills','Richman','Sandy Shores','Paleto Bay','Postal','Hospital','Capitol','Fire Station','Auto Fair','Bahama Mamas Bar','Tequi-la-la Bar','FIB','Hotel Spa Bar','Pacific Bluffs Country Club','Diamond Resort Bar','Vanilla Unicorn Bar','Church','Stock Exchange','Stadium','Chumash','Lifeinvader','Del Perro Pier','Del Perro Beach','Cayo Perico Island','Hotel','Raton Canyon','School','SAHP'];
    const UNOFFICIAL_PLACES = ['airport','autosalon','beach','beach market','ghetto','post office','train station','yacht'];
    const BUSINESS_LIST = ['Ammunition Store','Bar','Car wash','Chip tuning','Clothing shop','Cowshed','Electric station','Farm','Flower shop','Freight train','Gas station','Hair salon','Jewelry store','Oil Well','Parking','Plantation','Car sharing','State object','Service station','24/7 Store','Tattoo studio','Taxi company','ATM','Juice shop','Burger shop','Warehouse'];

    const BLACKLIST = new Set([
      'firearm','firearms','gun','guns','weapon','weapons','pistol','rifle','shotgun','ammo','ammunition',
      'bulletproof vest','bulletproof vests','armor plates','armor plate','armor',
      'weed','cannabis','cannabis seeds','weed seeds','drug','drugs','cocaine',
      'ems surgical mask','surgical mask','medical mask','covid mask','ems mask',
      'vehicle scanner','human scanner','resource scanner','scanner','radar','anti-radar',
      'balaclava','balaclava mask','bandit mask',
      'rope','ropes','head bag','head bags',
      'usb with virus',
      'lock pick','lock picks','lockpick','lockpicks','crowbar','crowbars',
      'animal skin','satellite dish','barricade','engine block','air horn'
    ]);

    const dotThousands = n => String(Math.trunc(Math.abs(Number(n)))).replace(/\B(?=(\d{3})+(?!\d))/g, '.');

    function normalizeMoney(str){
      if (!str) return '';
      let t = ' ' + String(str).trim() + ' ';
      t = t.replace(/\$?\s*([\d.,]+)\s*([kKmM])\b/g, (_, num, suf) => {
        const val = parseFloat(String(num).replace(/,/g,'.'));
        if (!isFinite(val)) return `$${num}`;
        if (suf.toLowerCase()==='k') return `$${dotThousands(Math.round(val*1000))}`;
        return `$${val % 1 === 0 ? val.toFixed(0) : String(val)} Million`;
      });
      t = t.replace(/\$?\s*(\d{1,3}(?:[,.]\d{3})+|\d+)(?!\s*Million)\b/g, (_, num) => {
        const clean = String(num).replace(/,/g,'');
        if (!/^\d+(\.\d+)?$/.test(clean)) return `$${num}`;
        return `$${dotThousands(clean)}`;
      });
      t = t.replace(/\bnegotiable\b/ig,'Negotiable').replace(/\beach\b/ig,'each');
      return t.trim();
    }
    function addEndPeriod(s){
      s = s.trim();
      if (/\d$/.test(s) && !/\bMillion\.$/i.test(s)) return s;
      if (!s.endsWith('.')) s += '.';
      return s;
    }
    function fixPlaces(text){
      OFFICIAL_PLACES.forEach(p => text = text.replace(new RegExp(p.replace(/[()]/g,'\\$&'), 'ig'), p));
      UNOFFICIAL_PLACES.forEach(p => text = text.replace(new RegExp(`\\b${p}\\b`, 'ig'), p.toLowerCase()));
      return text;
    }
    function containsBlacklist(str){
      const s = lc(str);
      for (const bad of BLACKLIST) if (s.includes(bad)) return bad;
      return null;
    }
    function licenseOK(text){
      const m = /\blicense plate\s*\(([^)]+)\)/i.exec(text);
      if (!m) return true;
      const val = m[1].trim();
      return val.length>=3 && val.length<=7;
    }
    function copyText(){
      const v = $('finalOutput').value.trim();
      if (!v) return;
      navigator.clipboard.writeText(v);
    }
    function clearRaw(){
      $('rawInput').value='';
      $('finalOutput').value='';
      $('chips').innerHTML='';
      $('checks').innerHTML='';
      $('errors').innerHTML='';
    }
    function chip(label, cls=''){ return `<span class="chip ${cls}">${label}</span>`; }
    function showChips({category, action, moneyLabel}){
      $('chips').innerHTML = [
        chip(`Detected: ${category}`,'ok'),
        chip(`Action: ${action}`,'ok'),
        moneyLabel ? chip(`Money: ${moneyLabel}`,'ok') : ''
      ].join(' ');
    }
    function setChecks(txt, opener){
      const box = $('checks'); box.innerHTML = '';
      const add = (msg, cls='') => box.insertAdjacentHTML('beforeend', `<span class="chip ${cls}">${msg}</span> `);
      /^[A-Z]/.test(txt) ? add('Capitalization ‚úì','ok') : add('Capitalization ‚úï','bad');
      if (opener==='Buying') /Budget:/.test(txt) ? add('Buyer‚ÜíBudget ‚úì','ok') : add('Buyer‚ÜíBudget ‚úï','bad');
      if (opener==='Selling' || opener==='Selling or trading') /Price:/.test(txt) ? add('Seller‚ÜíPrice ‚úì','ok') : add('Seller‚ÜíPrice ‚úï','bad');
      if (opener==='Renting out') /Rent:/.test(txt) ? add('Rent ‚úì','ok') : add('Rent ‚úï','bad');
      /(\.|\d)$/.test(txt.trim()) ? add('End punctuation ‚úì','ok') : add('End punctuation ‚úï','bad');
      if (!licenseOK(txt)) add('License plate len ‚úï','bad'); else if (/\blicense plate\b/i.test(txt)) add('License plate ‚úì','ok');
    }
    function setErrors(arr){
      const box = $('errors'); box.innerHTML = '';
      arr.forEach(e => box.insertAdjacentHTML('beforeend', `<div class="error-box mb-2">${e}</div>`));
    }

    // ===== Auto detection =====
    function detectAction(raw){
      let s=lc(raw);
      if (/\brenting\s+out\b|\brent(?:ing)?\b/.test(s)) return 'Renting out';
      if (/\bselling\s+or\s+trading\b/.test(s)) return 'Selling or trading';
      if (/\btrading\b|\btrade\b/.test(s)) return 'Trading';
      if (/\bbuy(?:ing|)\b|\blooking\s+to\s+buy\b|\blooking\s+to\s+purchase\b|\bpurchase\b/.test(s)) return 'Buying';
      if (/\bsell(?:ing)?\b/.test(s)) return 'Selling';
      if (/^looking\s+for\b/.test(s)) return 'Looking for';
      return 'Selling';
    }
    function moneyLabelFor(opener){
      if (opener==='Buying') return 'Budget';
      if (opener==='Renting out') return 'Rent';
      if (opener==='Trading' || opener==='Looking for') return '';
      return 'Price';
    }
    function detectCategory(raw){
      const s = lc(raw);
      if (/\b(house|apartment|penthouse|mansion)\b/.test(s)) return 'Real Estate';
      if (/\b(g\.s\.|w\.h\.|helipad|custom interior)\b/.test(s)) return 'Real Estate';
      if (/\bdrift kit|turbo kit|visual upgrades|luminous wheels|with full configuration|with partial configuration\b/.test(s)) return 'Auto';
      if (/\"[^"]+\"/.test(raw)) return 'Auto';
      for (const b of BUSINESS_LIST){ if (s.includes(lc(b))) return 'Business'; }
      if (/^looking\s+for\b/.test(s) && /\b(boyfriend|girlfriend|wife|husband|valentine|friends?|family|casino poker players)\b/.test(s)) return 'Dating';
      if (/\bhiring\b|\blooking\s+for\s+work\b|\bsalary\b|\bconstruction site ‚Ññ\d\b/.test(s)) return 'Work';
      return 'Other';
    }

    // ===== Builders (same rules as before) =====
    function buildReal(opener, s){
      const errors=[];
      let numMatch = s.match(/\b(?:no\.?|number|num|#|‚Ññ)\s*([0-9]{1,6})\b/i) || s.match(/\b(house|apartment|penthouse|mansion)\s*(?:no\.?|number|num|#|‚Ññ)?\s*([0-9]{1,6})\b/i);
      let typeMatch = s.match(/\b(house|apartment|penthouse|mansion)\b/i);
      let type = typeMatch ? typeMatch[1].toLowerCase() : 'house';
      let subject;
      if (numMatch && numMatch[2]) subject = `${type} ‚Ññ${numMatch[2]}`;
      else if (numMatch && numMatch[1]) subject = `${type} ‚Ññ${numMatch[1]}`;
      else subject = (/^[aeiou]/i.test(type)?'an ':'a ') + type;

      const feats=[];
      if (/\bgarden\b/i.test(s)) feats.push('a garden');
      const gs = s.match(/\b(2|5|9|25)\s*(?:g\.?s\.?)\b/i); if (gs) feats.push(`${gs[1]} g.s.`);
      const wh = s.match(/\b(\d+)\s*(?:w\.?h\.?)\b/i); if (wh) feats.push(`${wh[1]} w.h.`);
      if (/\bcustom\s+interior\b/i.test(s)) feats.push('custom interior');
      if (/\binsurance\b/i.test(s) && type!=='apartment') feats.push('insurance');
      else if (/\binsurance\b/i.test(s) && type==='apartment') errors.push('Apartments cannot be insured.');
      if (/\bhelipad\b/i.test(s)) feats.push('helipad');
      if (/\bswimming\s+pool\b/i.test(s)) feats.push('swimming pool');
      if (/\btennis\s+court\b/i.test(s)) feats.push('tennis court');
      if (/\blong\s+driveway\b/i.test(s)) feats.push('long driveway');
      if (/\b(spacious\s+)?backyard\b/i.test(s)) feats.push('spacious backyard');
      if (/\b(nice|beautiful|great)\s+views?\b/i.test(s)) feats.push('nice views');

      if (feats.length){
        const tail = feats.length===1 ? feats[0] : feats.slice(0,-1).join(', ') + ' and ' + feats.slice(-1);
        subject += ` with ${tail}`;
      }

      let locMatch = s.match(/\b(in|near)\s+([A-Za-z][A-Za-z ]+[A-Za-z])\b/);
      if (locMatch){ subject += ` ${locMatch[1]} ${locMatch[2]}`; }
      subject = subject.replace(/\bCasino apartment\b/ig,'Casino penthouse');
      subject = addEndPeriod(tcFirst(fixPlaces(subject)));

      let label = moneyLabelFor(opener);
      let amtRaw = (s.match(/\b(price|budget|rent)\s*[:\-]?\s*([^.,\n]+(?:Million)?(?:\s*each)?)\b/i) || [,'', ''])[2] || (s.match(/\$(?:\s*)[\d\.\,]+(?:\s*Million)?(?:\s*each)?/i)||[''])[0];
      let mline = '';
      if (label){
        if (!amtRaw || /negotiable/i.test(amtRaw)) mline = `${label}: Negotiable.`;
        else {
          const norm = normalizeMoney(amtRaw);
          const endNum = /\d$/.test(norm) && !/\bMillion\b/.test(norm);
          mline = `${label}: ${norm}${endNum?'':'.'}`;
        }
      }
      if ((opener==='Trading' || opener==='Selling or trading') && /\b(house|apartment|penthouse|mansion)\b/i.test(subject)) {
        errors.push('Houses and apartments are not tradable.');
      }
      return { text: `${opener} ${subject}${mline?' '+mline:''}`, errors };
    }

    function buildAuto(opener, s){
      const errors=[];
      let name = (s.match(/"([^"]+)"/)||[])[0];
      if (!name){
        const nm = s.match(/\b([A-Z][a-zA-Z]+(?:[- ](?:[A-Z0-9][a-zA-Z0-9()\-]+))+)\b/);
        name = nm ? `"${nm[1]}"` : 'a car';
      }
      const bits=[];
      if (/\b(full\s*config|max\s*config|fully\s*upgraded)\b/i.test(s)) bits.push('with full configuration');
      else if (/\b(partial|nearly max|lvl ?[1-3])\b/i.test(s)) bits.push('with partial configuration');
      if (/\bvisual\b|\bbody kit\b|\bbody upgrades\b/i.test(s)) bits.push('visual upgrades');
      if (/\bluminous (rims|wheels)|unique wheels/i.test(s)) bits.push('luminous wheels');
      if (/\binsurance\b/i.test(s)) bits.push('insurance');
      if (/\bturbo\b/i.test(s)) bits.push('turbo kit');
      if (/\bdrift\b/i.test(s)) bits.push('drift kit');

      let subject = name;
      if (bits.length){
        subject += ' ' + (bits[0].startsWith('with')? bits[0] : 'with '+bits[0]);
        if (bits.length>1) subject += ', ' + bits.slice(1).join(', ');
      }
      subject = addEndPeriod(tcFirst(subject));

      let label = moneyLabelFor(opener);
      let amtRaw = (s.match(/\b(price|budget|rent)\s*[:\-]?\s*([^.,\n]+(?:Million)?(?:\s*each)?)\b/i) || [,'', ''])[2] || (s.match(/\$(?:\s*)[\d\.\,]+(?:\s*Million)?/i)||[''])[0];
      let mline = '';
      if (label){
        if (!amtRaw || /negotiable/i.test(amtRaw)) mline = `${label}: Negotiable.`;
        else {
          const norm = normalizeMoney(amtRaw);
          const endNum = /\d$/.test(norm) && !/\bMillion\b/.test(norm);
          mline = `${label}: ${norm}${endNum?'':'.'}`;
        }
      } else if (amtRaw){
        const norm = normalizeMoney(amtRaw);
        const endNum = /\d$/.test(norm) && !/\bMillion\b/.test(norm);
        mline = `Price: ${norm}${endNum?'':'.'}`;
      }
      return { text: `${opener} ${subject}${mline?' '+mline:''}`, errors };
    }

    function buildBusiness(opener, s){
      const errors=[];
      let name = BUSINESS_LIST.find(b => lc(s).includes(lc(b))) || 'ATM';
      let num = (s.match(/\b(?:no\.?|number|num|#|‚Ññ)\s*(\d+)\b/i)||[])[1];
      let subj = name + (num? ` ‚Ññ${num}` : ' business');
      subj = addEndPeriod(tcFirst(subj));

      let label = moneyLabelFor(opener) || 'Price';
      let amtRaw = (s.match(/\b(price|budget)\s*[:\-]?\s*([^.,\n]+(?:Million)?)\b/i) || [,'',''])[2] || (s.match(/\$(?:\s*)[\d\.\,]+(?:\s*Million)?/i)||[''])[0];
      let mline='';
      if (!amtRaw || /negotiable/i.test(amtRaw)) mline = `${label}: Negotiable.`;
      else {
        let norm = normalizeMoney(amtRaw);
        const over = /\$?(\d+)\s*Million/i.exec(norm);
        if (over && Number(over[1])>300) norm = 'Negotiable';
        const endNum = /\d$/.test(norm) && !/\bMillion\b/.test(norm);
        mline = `${label}: ${norm}${endNum?'':'.'}`;
      }
      return { text: `${opener} ${subj} ${mline}`.trim(), errors };
    }

    function buildDating(s){
      const errors=[];
      let personMatch = s.match(/\b([A-Z][a-z]+)\s+([A-Z][a-z]+)\b/);
      let base = 'Looking for ';
      if (personMatch){
        base += `${tcFirst(personMatch[1])} ${tcFirst(personMatch[2])}.`;
      } else {
        const phrase = (s.match(/looking\s+for\s+([a-z ]+)/i)||[])[1];
        base += phrase ? phrase.trim().replace(/\.$/, '') + '.' : 'a friend.';
      }
      return { text: addEndPeriod(tcFirst(base)), errors };
    }

    function buildWork(s){
      const errors=[];
      let hiring = /\bhiring\b/i.test(s);
      let role = (s.match(/\bhiring\s+([a-z ]+)/i)||[])[1] || (s.match(/\blooking\s+for\s+work\s+as\s+([a-z ]+)/i)||[])[1] || (s.match(/\b(driver|lawyer|dj|photographer|bodyguard|dancer|professional singer|assistant|trucker|electrician|gardener|surveyor|locksmith)\b/i)||[])[1] || 'workers';
      role = role.trim();
      let subj = hiring ? `Hiring ${role}` : `${tcFirst(role)} looking for work`;

      const site = (s.match(/construction site\s*(?:‚Ññ|#)?\s*(1|2|3)/i)||[])[1];
      if (site){
        const siteMap = {1:'Vespucci Boulevard',2:'Calais Avenue',3:'Pillbox Hill'};
        subj += ` at Construction site ‚Ññ${site}, ${siteMap[site]}`;
      }
      subj = addEndPeriod(tcFirst(subj));

      let salaryRaw = (s.match(/\b(?:salary|pay|bonus)\s*[:\-]?\s*([^.,\n]+(?:Million)?)\b/i)||[])[1];
      let mline = salaryRaw ? `Salary: ${normalizeMoney(salaryRaw)}` : 'Salary: Negotiable';
      if (!/\.$/.test(mline)) mline = addEndPeriod(mline);

      return { text: `${subj} ${mline}`.trim(), errors };
    }

    function buildOther(opener, s){
      const errors=[];
      let itemStr = (s.match(/\b(?:selling|buying)\b\s+(.+)/i)||[])[1] || s;
      let items = itemStr.split(/,| and /i).map(x=>x.replace(/\b(price|budget|rent)\b.*$/i,'').trim()).filter(Boolean);
      if (items.length>3) errors.push('Cannot advertise more than 3 items at a time.');
      if (items.length===0) items = ['items'];

      let subject = `${opener} ` + (items.length===1 ? items[0] : items.join(', ').replace(/,([^,]*)$/,' and$1'));
      subject = addEndPeriod(tcFirst(subject));

      let isBeachMarket = /beach market shop ‚Ññ\d+/i.test(s);
      let label = moneyLabelFor(opener);
      let amtRaw = (s.match(/\b(price|budget)\s*[:\-]?\s*([^.,\n]+(?:Million)?(?:\s*each)?)\b/i) || [,'',''])[2] || (s.match(/\$(?:\s*)[\d\.\,]+(?:\s*Million)?(?:\s*each)?/i)||[''])[0];
      let mline = '';
      if (label){
        if (!amtRaw || /negotiable/i.test(amtRaw)) mline = `${label}: Negotiable.`;
        else {
          const norm = normalizeMoney(amtRaw);
          const endNum = /\d$/.test(norm) && !/\bMillion\b/.test(norm);
          mline = `${label}: ${norm}${endNum?'':'.'}`;
        }
      } else if (amtRaw){
        const norm = normalizeMoney(amtRaw);
        const endNum = /\d$/.test(norm) && !/\bMillion\b/.test(norm);
        mline = `Price: ${norm}${endNum?'':'.'}`;
      }
      if (isBeachMarket && /Negotiable\.$/i.test(mline)) mline = '';
      return { text: `${subject}${mline? ' '+mline:''}`, errors };
    }

    // ===== Raw entry point =====
    function detectCategory(raw){
      const s = lc(raw);
      if (/\b(house|apartment|penthouse|mansion)\b/.test(s)) return 'Real Estate';
      if (/\b(g\.s\.|w\.h\.|helipad|custom interior)\b/.test(s)) return 'Real Estate';
      if (/\bdrift kit|turbo kit|visual upgrades|luminous wheels|with full configuration|with partial configuration\b/.test(s)) return 'Auto';
      if (/\"[^"]+\"/.test(raw)) return 'Auto';
      for (const b of BUSINESS_LIST){ if (s.includes(lc(b))) return 'Business'; }
      if (/^looking\s+for\b/.test(s) && /\b(boyfriend|girlfriend|wife|husband|valentine|friends?|family|casino poker players)\b/.test(s)) return 'Dating';
      if (/\bhiring\b|\blooking\s+for\s+work\b|\bsalary\b|\bconstruction site ‚Ññ\d\b/.test(s)) return 'Work';
      return 'Other';
    }

    function generateFromRaw(){
      const raw = ($('rawInput').value||'').trim();
      $('finalOutput').value=''; $('chips').innerHTML=''; $('checks').innerHTML=''; $('errors').innerHTML='';
      if (!raw) return;

      const bad = containsBlacklist(raw);
      if (bad){ setErrors([`Rejected: contains blacklisted term: ${bad}`]); return; }

      const action = detectAction(raw);
      const category = detectCategory(raw);
      const moneyLabel = moneyLabelFor(action);
      let out='', errs=[];
      const s = raw
        .replace(/looking to buy|looking to purchase/ig,'Buying')
        .replace(/\bbuyyingng\b/ig,'Buying')
        .replace(/\bno\.\b/ig,'‚Ññ')
        .replace(/\bhouse\s*(?:number|num|#)\s*/ig,'house ‚Ññ')
        .replace(/\bapartment\s*(?:number|num|#)\s*/ig,'apartment ‚Ññ');

      if (category==='Real Estate'){ ({text:out, errors:errs}=buildReal(action, s)); }
      else if (category==='Auto'){ ({text:out, errors:errs}=buildAuto(action, s)); }
      else if (category==='Business'){ ({text:out, errors:errs}=buildBusiness(action, s)); }
      else if (category==='Dating'){ ({text:out, errors:errs}=buildDating(s)); }
      else if (category==='Work'){ ({text:out, errors:errs}=buildWork(s)); }
      else { ({text:out, errors:errs}=buildOther(action, s)); }

      out = out.replace(/\bhouse\s+no\s+(\d+)/ig,'house ‚Ññ$1')
               .replace(/\bapartment\s+no\s+(\d+)/ig,'apartment ‚Ññ$1')
               .replace(/\bpenthouse\s+no\s+(\d+)/ig,'penthouse ‚Ññ$1')
               .replace(/\bmansion\s+no\s+(\d+)/ig,'mansion ‚Ññ$1');

      out = out.replace(/\b(Price|Budget|Rent):\s*([^.\n]+)(?!\.)/g, (_,L,val)=>{
        const norm=normalizeMoney(val);
        return `${L}: ${norm}${/\d$/.test(norm)&&!/\bMillion\b/.test(norm)?'':'.'}`;
      });

      out = tcFirst(fixPlaces(out));
      if (!licenseOK(out)) errs.push('License plate must be 3‚Äì7 characters in length.');

      $('finalOutput').value = out;
      showChips({category, action, moneyLabel});
      setChecks(out, action);
      setErrors(errs);
    }
  </script>
</body>
</html>
